{% load cms_tags staticfiles sekizai_tags menu_tags %}
{% load render_bundle from webpack_loader %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FRBE-KBSB</title>
<meta name="viewport" content="width=device-width,initial-scale=1"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
{% render_block "css" %}
{% if PRODUCTION %}
  {% render_bundle 'chunk-vendors'  'css' %}
  {% render_bundle 'cms' 'css' %}
{% endif %}
<!-- <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-116219765-1');
</script> -->
</head>
<body>

{% cms_toolbar %}

<div id="app"></div>

<div id="cms-content" style="display:none;">
  {%  placeholder "content" %}
  {% block extra_content %}{% endblock extra_content %}   
</div>

<div id="cms-menu-items" style="display:none;">
  {%  show_menu 0 100 100 100 %}
</div>

{% if PRODUCTION %}
  {% render_bundle 'chunk-vendors' 'js' %}
  {% render_bundle 'cms' 'js' %}
{% else %}
  {% render_bundle 'cms' %}
{% endif %}

{% render_block "js" %}

<script>

function registerComponent(id, options) {
  let cmscontent = document.getElementById(id),
      chtml='';
  // filter out <template> and <script> tags
  for (let i=0; i<cmscontent.children.length; i++) {
    let tag = cmscontent.children[i].tagName;
    if (tag != 'TEMPLATE'  && tag != 'SCRIPT') {
      chtml += cmscontent.children[i].outerHTML;
    }
  }
  application.Vue.component(id, {
    template: '<div>' + chtml + '</div>',
    data: (options && options.data) || function(){ return{}},
    methods: (options && options.methods) || {},
  });
}

function startup () {
  console.log('window.config in startup.js 1 ', window.config);
  registerComponent('cms-content', {
    data: function (){return { tabactive: 0}},
    methods: { marked: window.config.marked},
  });
  registerComponent('cms-menu-items');

  application.Vue.config.ignoredElements = [
    'cms-template',
    'cms-plugin',
  ];

  console.log('window.config in startup.js 1', window.config);

  window.config = window.config || {};
  window.config = {
    {% block extra_config %}{% endblock extra_config %}
    marked: window.config.marked,
    production: '{{ PRODUCTION }}',
    api_url: '/api',
    lang: '{{ LANGUAGE_CODE }}',
    url_i18n: {
      nl: "{% page_language_url 'nl' %}",
      fr: "{% page_language_url 'fr' %}",
      de: "{% page_language_url 'de' %}",
      en: "{% page_language_url 'en' %}",
    }
  };
  console.log('window.config in startup.js 2', window.config);

  vm = new application.Vue({
    render: h => h(application.App),
    i18n: application.i18n,
    store: application.store,
    created () {
      new application.VueCmsPatch(this)
    },
  }).$mount('#app');

}

startup();

</script>

</body>
</html>